{"version":3,"sources":["turbopack:///[project]/components/learner/PortfolioManager.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/app/(learner)/learner/portfolio/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PortfolioManager = registerClientReference(\n    function() { throw new Error(\"Attempted to call PortfolioManager() from the server but PortfolioManager is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/learner/PortfolioManager.tsx\",\n    \"PortfolioManager\",\n);\n","import { collection, doc, getDoc, getDocs, query, where } from 'firebase/firestore';\nimport { db } from '@/lib/firebase-client';\nimport { COLLECTION_NAMES, Competency, Rating, Artifact } from '@/types';\nimport { UserConverter, RatingConverter, CompetencyConverter, ArtifactConverter } from '@/lib/converters';\nimport { PortfolioManager } from '@/components/learner/PortfolioManager';\n\nexport const dynamic = 'force-dynamic';\n\n// Hardcoded for POC\nconst LEARNER_ID = 'test-learner-main';\n\n// Helper to group ratings by competency and calculate average\nfunction groupRatingsByCompetency(ratings: Rating[], competencies: Competency[]) {\n  const competencyMap = new Map(competencies.map(c => [c.id, c]));\n  const grouped = new Map<string, { competency: Competency; ratings: Rating[]; average: number }>();\n\n  for (const rating of ratings) {\n    if (rating.status !== 'completed' || rating.score === undefined) continue;\n\n    const competency = competencyMap.get(rating.competency_id);\n    if (!competency) continue;\n\n    if (!grouped.has(rating.competency_id)) {\n      grouped.set(rating.competency_id, {\n        competency,\n        ratings: [],\n        average: 0,\n      });\n    }\n\n    grouped.get(rating.competency_id)!.ratings.push(rating);\n  }\n\n  // Calculate averages\n  for (const [, data] of grouped) {\n    const sum = data.ratings.reduce((acc, r) => acc + (r.score || 0), 0);\n    data.average = sum / data.ratings.length;\n  }\n\n  return Array.from(grouped.values());\n}\n\nexport default async function PortfolioPage() {\n  // Fetch learner\n  const learnerRef = doc(db, COLLECTION_NAMES.users, LEARNER_ID).withConverter(UserConverter);\n  const learnerSnap = await getDoc(learnerRef);\n  const learner = learnerSnap.data();\n\n  if (!learner) {\n    return <div>Learner not found</div>;\n  }\n\n  // Fetch completed ratings for this learner\n  const ratingsRef = collection(db, COLLECTION_NAMES.ratings).withConverter(RatingConverter);\n  const ratingsQuery = query(\n    ratingsRef,\n    where('learner_id', '==', LEARNER_ID),\n    where('status', '==', 'completed')\n  );\n  const ratingsSnap = await getDocs(ratingsQuery);\n  const ratings = ratingsSnap.docs.map((doc) => doc.data());\n\n  // Fetch all competencies\n  const competenciesRef = collection(db, COLLECTION_NAMES.competencies).withConverter(CompetencyConverter);\n  const competenciesSnap = await getDocs(competenciesRef);\n  const competencies = competenciesSnap.docs.map((doc) => doc.data());\n\n  // Fetch artifacts for this learner\n  const artifactsRef = collection(db, COLLECTION_NAMES.artifacts).withConverter(ArtifactConverter);\n  const artifactsQuery = query(artifactsRef, where('learner_id', '==', LEARNER_ID));\n  const artifactsSnap = await getDocs(artifactsQuery);\n  const artifacts = artifactsSnap.docs.map((doc) => doc.data());\n\n  // Group ratings by competency\n  const groupedCompetencies = groupRatingsByCompetency(ratings, competencies);\n\n  return (\n    <PortfolioManager\n      learnerId={LEARNER_ID}\n      learner={learner}\n      competencies={groupedCompetencies}\n      artifacts={artifacts}\n    />\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}