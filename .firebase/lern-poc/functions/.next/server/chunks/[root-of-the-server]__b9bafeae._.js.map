{"version":3,"sources":["turbopack:///[project]/lib/converters.ts"],"sourcesContent":["/**\n * Firestore data converters for type-safe document reads/writes\n *\n * Usage (client SDK):\n *   const ref = collection(db, COLLECTION_NAMES.users).withConverter(UserConverter);\n *   const users = await getDocs(ref);  // Fully typed!\n *\n * Usage (admin SDK):\n *   const ref = adminDb.collection(COLLECTION_NAMES.users);\n *   const doc = await ref.doc(userId).get();\n *   const user = convertFirestoreDoc<User>(doc);\n */\n\nimport {\n  FirestoreDataConverter,\n  QueryDocumentSnapshot,\n  Timestamp,\n} from 'firebase/firestore';\nimport type {\n  User,\n  Organization,\n  Competency,\n  Rating,\n  Artifact,\n} from '@/types';\n\n/**\n * Helper: Convert Firestore Timestamp to Date\n */\nfunction timestampToDate(timestamp: any): Date {\n  if (timestamp instanceof Date) return timestamp;\n  if (timestamp?.toDate) return timestamp.toDate();\n  return new Date(timestamp);\n}\n\n/**\n * Helper: Convert Date to Firestore Timestamp for writes\n */\nfunction dateToTimestamp(date: Date | Timestamp | undefined): any {\n  if (!date) return undefined;\n  // If already a Timestamp, return as-is\n  if (date instanceof Timestamp) return date;\n  // Convert Date to Timestamp\n  return Timestamp.fromDate(date);\n}\n\n/**\n * Generic converter for any entity type\n * Handles ID stripping on write, timestamp conversion on read\n */\nfunction createConverter<T extends { id: string; created_at: Date }>(\n): FirestoreDataConverter<T> {\n  return {\n    toFirestore: (entity: T) => {\n      const { id, created_at, updated_at, ...data } = entity as any;\n      return {\n        ...data,\n        created_at: dateToTimestamp(created_at) || Timestamp.now(),\n        updated_at: dateToTimestamp(updated_at),\n      };\n    },\n    fromFirestore: (snapshot: QueryDocumentSnapshot) => {\n      const data = snapshot.data();\n      return {\n        ...data,\n        id: snapshot.id,\n        created_at: timestampToDate(data.created_at),\n        updated_at: data.updated_at ? timestampToDate(data.updated_at) : undefined,\n      } as unknown as T;\n    },\n  };\n}\n\n/**\n * Converters for each entity type\n */\nexport const OrganizationConverter = createConverter<Organization>();\nexport const UserConverter = createConverter<User>();\nexport const CompetencyConverter = createConverter<Competency>();\nexport const RatingConverter = createConverter<Rating>();\nexport const ArtifactConverter = createConverter<Artifact>();\n\n/**\n * Helper for Admin SDK: Convert a Firestore DocumentSnapshot to typed entity\n * (Admin SDK doesn't support withConverter in the same way)\n */\nexport function convertFirestoreDoc<T extends { id: string; created_at: Date }>(\n  doc: any\n): T | null {\n  if (!doc.exists) return null;\n  const data = doc.data();\n  return {\n    id: doc.id,\n    ...data,\n    created_at: timestampToDate(data.created_at),\n    updated_at: data.updated_at ? timestampToDate(data.updated_at) : undefined,\n  } as T;\n}\n\n/**\n * Helper for Admin SDK: Convert query snapshot to typed array\n */\nexport function convertFirestoreDocs<T extends { id: string; created_at: Date }>(\n  snapshot: any\n): T[] {\n  return snapshot.docs.map((doc: any) => convertFirestoreDoc<T>(doc)).filter(Boolean);\n}\n"],"names":[],"mappings":"4+BAaA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAgBA,SAAS,EAAgB,CAAc,SACrC,AAAI,aAAqB,KAAa,CAAP,CAC3B,GAAW,OAAe,CAAP,CAAiB,MAAM,GACvC,IAAI,KAAK,EAClB,CAKA,SAAS,EAAgB,CAAkC,EACzD,GAAK,CAAD,KAAO,GAEX,AAAI,IAFc,SAEE,EAAA,SAAS,CAAS,CAAP,CAExB,EAAA,SAAS,CAAC,QAAQ,CAAC,EAC5B,CAMA,SAAS,IAEP,MAAO,CACL,YAAa,AAAC,IACZ,GAAM,CAAE,IAAE,YAAE,CAAU,YAAE,CAAU,CAAE,GAAG,EAAM,CAAG,EAChD,MAAO,CACL,GAAG,CAAI,CACP,WAAY,EAAgB,IAAe,EAAA,SAAS,CAAC,GAAG,GACxD,WAAY,EAAgB,EAC9B,CACF,EACA,cAAe,AAAC,IACd,IAAM,EAAO,EAAS,IAAI,GAC1B,MAAO,CACL,GAAG,CAAI,CACP,GAAI,EAAS,EAAE,CACf,WAAY,EAAgB,EAAK,UAAU,EAC3C,WAAY,EAAK,UAAU,CAAG,EAAgB,EAAK,UAAU,OAAI,CACnE,CACF,CACF,CACF,CAKqC,IACR,IACtB,IAAM,EAAsB,IACJ,IACE"}