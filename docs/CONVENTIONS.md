# LERN Code Conventions

This document defines naming conventions and coding practices for the LERN codebase. **Consistency is the goal** - following these patterns keeps the codebase maintainable.

---

## TypeScript Naming

### Types & Interfaces
- **PascalCase** for all types and interfaces
- No `I` prefix (not `IUser`, just `User`)
- Noun or noun phrase describing the entity

```typescript
// Good
interface User { ... }
type RaterType = 'self' | 'mentor' | 'master';
interface CompetencyRating { ... }

// Bad
interface IUser { ... }
interface user { ... }
type raterType = 'self' | 'mentor' | 'master';
```

### Functions
- **camelCase** for function names
- Verb or verb phrase describing the action
- React/UI components use **PascalCase** (exception)

```typescript
// Good
function createCompetency() { ... }
function getUserRatings() { ... }
export function CompetencyCard() { ... }  // React component

// Bad
function CreateCompetency() { ... }
function get_user_ratings() { ... }
```

### Variables & Constants
- **camelCase** for variables (`let`, `const`)
- **UPPER_SNAKE_CASE** for global constants

```typescript
// Good
const userId = "abc123";
const MAX_FILE_SIZE = 50 * 1024 * 1024;  // Global constant

// Bad
const UserId = "abc123";
const max_file_size = 50 * 1024 * 1024;
```

### Files
- **kebab-case** for directories and files
- **PascalCase** for files exporting React components

```
// Good
types/competency.ts
lib/firebase-client.ts
components/CompetencyCard.tsx
app/educator/create-competency/page.tsx

// Bad
types/Competency.ts
lib/FirebaseClient.ts
components/competency-card.tsx
```

---

## Firestore Naming

### Collection Names
- **snake_case** (lowercase with underscores)
- Plural nouns

```typescript
// Good
'users'
'competencies'
'verification_requests'

// Bad
'Users'
'competency'
'verificationRequests'
```

### Document Field Names
- **snake_case** (lowercase with underscores)
- Matches TypeScript property names after conversion

```typescript
// Firestore document
{
  "user_id": "abc123",
  "org_id": "org456",
  "created_at": Timestamp,
  "display_name": "Jane Educator"
}

// TypeScript type (same names)
interface User {
  user_id: string;
  org_id: string;
  created_at: Date;
  display_name: string;
}
```

**Rationale**: Using `snake_case` for both Firestore fields and TypeScript properties eliminates mapping logic in converters. No need to transform `created_at` ↔ `createdAt`.

### Document IDs
- Auto-generated by Firestore (`doc().id`) OR
- Kebab-case slugs for human-readable IDs (e.g., `python-programming-101`)

---

## Type Structure

### Base Fields
All entities include these fields:

```typescript
interface BaseEntity {
  id: string;                // Firestore document ID
  created_at: Date;          // Timestamp when created
  updated_at?: Date;         // Optional: when last modified
}
```

### Type Location
- One type per file in `/types/` directory
- Export all types from `/types/index.ts` for convenience

```typescript
// types/user.ts
export interface User extends BaseEntity {
  email: string;
  org_id: string;
  roles: Role[];
  display_name: string;
}

// types/index.ts
export * from './user';
export * from './competency';
export * from './rating';
// ... all other exports
```

---

## Helper Function Patterns

### Firestore Converters
- Location: `/lib/converters.ts`
- One converter per type, named `{Type}Converter`
- Pattern: `toFirestore` strips ID, `fromFirestore` adds it back from snapshot

### Shared Utilities
- Location: `/lib/utils.ts` or `/lib/{feature}-utils.ts`
- Pure functions only (no side effects)
- Prefix with verb: `validate`, `format`, `calculate`, `generate`

### Client-Only Utilities
- Location: `/lib/client/` (e.g., `storage-helpers.ts`)
- For browser-specific APIs (file uploads, local storage)

### Server-Only Utilities
- Location: `/lib/server/` (e.g., `admin-helpers.ts`)
- For Firebase Admin SDK operations

---

## Project Structure & File Organization

### Top-Level Directories
- `app/` - Next.js App Router (pages & layouts)
- `components/` - React components (organized by feature, not type)
- `lib/` - Firebase config, converters, utilities
- `types/` - TypeScript type definitions
- `docs/` - Project documentation
- `public/` - Static assets

### Route Organization Principles
- Use route groups `(groupName)` to organize routes without affecting URLs
- Example: `(educator)/educator/page.tsx` → URL is `/educator` not `/(educator)/educator`
- Each route group can have its own `layout.tsx` for shared UI
- Groups: `(educator)`, `(learner)`, `(public)`

### Component Organization Principles
- Organize by **feature**, not by component type
- ✅ `components/competency/CompetencyCard.tsx`
- ❌ `components/cards/CompetencyCard.tsx`
- Keep flat structure - avoid deep nesting
- `components/ui/` reserved for shadcn base components

### Lib Organization
- Core files: `firebase-client.ts`, `firebase-admin.ts`, `converters.ts`, `utils.ts`
- Feature-specific utils: `lib/rating-utils.ts`
- Client-only: `lib/client/storage-helpers.ts`
- Server-only: `lib/server/admin-helpers.ts`

### Component Naming
- **PascalCase** for component files and function names
- Default export for pages
- Named exports for reusable components

```typescript
// components/CompetencyCard.tsx
export function CompetencyCard({ competency }: { competency: Competency }) {
  return <Card>...</Card>;
}

// app/educator/page.tsx
export default function EducatorDashboard() {
  return <div>...</div>;
}
```

---

## Comments & Documentation

### When to Comment
- **Type definitions**: Add JSDoc for complex types
- **Utility functions**: Explain non-obvious logic
- **Magic numbers**: Explain constants (e.g., `50 * 1024 * 1024 // 50MB`)
- **Business rules**: Document why, not what

```typescript
/**
 * Represents a competency rating from self, mentor, or master evaluator.
 * Ratings are immutable once created - edits create new rating records.
 */
export interface Rating extends BaseEntity {
  learner_id: string;
  competency_id: string;
  rater_id: string;
  rater_type: 'self' | 'mentor' | 'master';
  score: 0 | 1 | 2 | 3 | 4;
  comment?: string;
  artifact_url?: string;
}

// Calculate weighted average (master ratings count 2x)
function calculateWeightedAverage(ratings: Rating[]): number {
  // Implementation...
}
```

### When NOT to Comment
- Obvious code that reads clearly
- Redundant explanations

```typescript
// Bad - comment adds no value
// Get the user by ID
const user = await getUser(userId);

// Good - self-documenting
const user = await getUserById(userId);
```

---

## Import Order

1. External libraries (React, Firebase, etc.)
2. Internal aliases (`@/types`, `@/lib`, `@/components`)
3. Relative imports (`./utils`, `../components`)
4. CSS/styles (if applicable)

```typescript
// Good
import { useState } from 'react';
import { collection, getDocs } from 'firebase/firestore';

import { Competency } from '@/types';
import { CompetencyConverter } from '@/lib/converters';
import { Button } from '@/components/ui/button';

import { formatDate } from './date-utils';
```

---

## Git Commit Messages

- **Lowercase**, imperative mood ("add feature" not "Added feature")
- Short summary (<50 chars), detailed body if needed

```
add competency CRUD for educator dashboard

- Create competency type and converter
- Build competency list view with real-time updates
- Add create competency form with validation
```

---

## TypeScript Best Practices

### Never Use `any`

**CRITICAL RULE**: Never use the `any` type. It defeats the purpose of TypeScript and hides bugs.

```typescript
// ❌ BAD - Never do this
function processData(data: any) { ... }
const result = something as any;

// ✅ GOOD - Use proper types
function processData(data: User | Competency) { ... }
const result = something as User; // Only when absolutely necessary and type-safe
```

**What to do instead**:
- Use specific types or interfaces
- Use union types (`string | number`)
- Use `unknown` if type is truly unknown, then narrow with type guards
- Create proper interfaces for complex objects
- Use generics for reusable type-safe functions

**Why this matters**: Using `any` is a sign you don't understand the data structure. Take time to properly type your data instead of taking shortcuts.

---

## Quality Assurance & Test Data Management

**Goal**: Minimize user QA effort by managing test data intelligently.

**User's Role**: Verify features look and act as expected.

**Claude's Role**:
- Create test data matching hardcoded IDs in the UI
- Provide clear testing instructions (where to navigate, what to expect)
- Wait for verification before moving to next feature

**Key Principles**:
1. Match test data to hardcoded IDs (e.g., `demo-learner-001`)
2. Tell user exactly where to test and what should happen
3. Don't chain features without verification checkpoints

---

## Summary: Quick Reference

| Item | Convention | Example |
|------|-----------|---------|
| Types/Interfaces | PascalCase | `User`, `CompetencyRating` |
| Functions | camelCase | `createCompetency()`, `getUserRatings()` |
| Variables | camelCase | `userId`, `competencyList` |
| Constants | UPPER_SNAKE_CASE | `MAX_FILE_SIZE`, `DEFAULT_ORG_ID` |
| React Components | PascalCase | `CompetencyCard`, `RatingForm` |
| Files (general) | kebab-case | `firebase-client.ts`, `rating-utils.ts` |
| Files (components) | PascalCase | `CompetencyCard.tsx` |
| Firestore Collections | snake_case | `users`, `verification_requests` |
| Firestore Fields | snake_case | `user_id`, `created_at`, `display_name` |
| Document IDs | auto-generated or kebab-case | `abc123xyz` or `python-101` |

---

**The Golden Rule**: When in doubt, be consistent with existing code. If you spot inconsistencies, fix them and update this document.
